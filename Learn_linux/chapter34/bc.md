
### 정밀 계산기 언어

우리는 쉘이 모든 종류의 정수 연산을 제어할 수 있는 것을 봤다. 하지만 복잡한 연산이 필요하거나 부동 소수점 수를 사용해야 한다면 어떻게 될까? 그 대답은, 할수 없다이다. 적어도 쉘에서 직접적으로는 말이다. 그래서 결국 이를 위해 외부 프로그램을 사용할 필요가 있다. 우리가 사용 가능한 여러 접근법들이 있다. 내장된 Perl 또는 AWK 프로그램도 그 해법 중 하나지만 이 책의 범위는 아니다.

또 다른 방법은 특정한 계산기 프로그램을 사용하는 것이다. 대부분 리눅스 시스템에 존재하는 프로그램 bc도 그 중 하나다.

bc 프로그램은 C와 유사한 언어로 작성된 파일을 읽고 실행한다. bc 스크립트는 독립된 파일이거나 표준 입력으로 읽어들일 수 있다. bc 언어는 변수, 반복문과 프로그래머 정의 함수를 포함한 꽤 다양한 기능을 제공한다. 여기서는 bc의 모든 부분을 다루지는 못한다. 다만 맛만 보는 것으로 마칠 것이다. bc는 [[man]] 페이지에 잘 문서화 되어 있기에 이를 참조하면 된다.

이제 간단한 예제로 시작해보자. 2 더하기 2를 계산하는 bc 스크립트를 작성할 것이다.

```shell
/* A very simple bc script*/

2 + 2
```

이 스크립트의 첫 줄은 주석이다. bc는 C 프로그래밍 언어와 동일한 문법의 주석을 사용한다. 주석은 `/*`에서 시작하여 `*/`로 끝나는 것으로 여러 줄에 나타날 수 있다.


### bc 사용

앞의 bc 스크립트를 foo.bc 라고 지정했다면 이처럼 실행할 수 있다.

```shell
┌──(kali㉿kali)-[~]
└─$ bc foo.bc
bc 1.07.1
Copyright 1991-1994, 1997, 1998, 2000, 2004, 2006, 2008, 2012-2017 Free Software Foundation, Inc.
This is free software with ABSOLUTELY NO WARRANTY.
For details type `warranty'. 
4


```

주의 깊게 살펴보면, 저작권 메시지 이후 가장 아랫부분에 계산 결과가 위치한 것을 볼 수 있다. 이 메시지는 `-q`(quiet) 옵션을 사용하여 숨길 수 있다.

bc는 또한 대화식으로도 사용할 수도 있다.

```shell
┌──(kali㉿kali)-[~]
└─$ bc -q    
2+2
4
quit

```

bc를 대화식으로 사용할 때는 단순히 우리가 계산을 원하는 것을 입력하면 된다. 그리고 그 결과는 즉시 표시된다. bc 명령 quit으로 대화 방식을 전달하는 것도 가능하다.

```shell
┌──(kali㉿kali)-[~]
└─$ bc < foo.bc
4

```

표준 입력에서 가져오는 기능은 스크립트를 전달하기 위해 here 문서, here 문자열, 파이프를 사용할 수 있다는 것을 의미한다. 다음은 **here string**의 예제다.

```shell
┌──(kali㉿kali)-[~]
└─$ bc <<< "2+2"
4
```

### 예제 스크립트

우리는 실생활의 예제로 월별 대출 상환금을 계산하는 스크립트를 구성할 것이다. 다음 스크립트에서 here 문서를 사용하여 bc에 스크립트를 전달한다.

```shell
#!/bin/bash

# loan-calc : script to calculate monthly loan payments

PROGNAME=$(basename $0)

usage(){

        cat <<- EOF
        Usage: $PROGNAME PRINCIPAL INTEREST MONTHS

        Where:

        PRINCIPAL is the amount of the loan.
        INTEREST is the APR as a number (7% = 0.07).
        MONTHS is the length of the loan's term.

        EOF

}

if (($# != 3)); then
        usage
        exit 1
fi

principal=$1
interest=$2
months=$3

bc <<- EOF
        scale = 10
        i = $interest / 12
        p = $principal
        n = $months
        a = p * ((i * ((1 + i) ^ n)) / (((1 + i) ^ n) -1))
        print a, "\n"
EOF
     ```
실행 결과는 다음과 같다.

```shell
                                                                                                                   
┌──(kali㉿kali)-[~]
└─$ ./loan-calc 13500 0.0775 180
127.0722249000

```

이 예제는 180개월(15년)짜리 연이율 7.75%dml `$135,000`대출에 대한 월별 상환금을 계산한다. 결과에 대한 소수점 정밀도는 bc 스크립트의 특별한 scale 변수로 결정된다. bc 스크립트 언어의 자세한 설명은 bc의 [[man]] 페이지를 참조하라. 쉘((bc는 C와 거의 유사하다)) 수학적 표기가 약간 차이가 나지만 지금까지 우리가 배웠던 것의 대부분은 유사할 것이다.

---
# 마무리 노트

우리는 스크립트에서 "실상황"에 사용할 수 있는 간단하지만 다양한 기능을 배웠다. 스크립팅 경험이 늘어날 때마다, 효율적으로 문자열과 수를 조작하는 능력은 그 진가를 발휘할 것이다. loan-calc 스크립트는 단순하다 해도 아주 유용하게 사용할 수 있다는 것을 증명해주고 있다.

---
# 추가 확인 사항

loan-calc 스크립트는 기본적인 기능에 충실하지만 완전함과는 거리가 있다. 추가적으로 loan-calc 스크립트에 다음 기능들을 더하여 개선해보도록 하자.

- 커맨드라인 인자의 유효성 검사
- 사용자로부터 원금, 이율, 대출 기간을 입력 받는 프롬프트를 표시하는 "대화식" 모드를 구현한 커맨드라인 옵션 제공
- 출력 포맷 개선