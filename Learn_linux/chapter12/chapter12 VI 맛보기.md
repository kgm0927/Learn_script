
- 이전 챕터: [[chapter11 환경]]

이번 장에 VI(브이 아이) 편집기에 대해서 소개하려고 한다. 이것은 유닉스 고유의 핵심 프로그램 중 하나다. vi는 사용자 인터페이스로 어렵기로 악명이 높다. 


---
# Vi를 왜 배워야 할까?


그래픽 환경이나 nano 같이 사용하기 편하도록 만든 텍스트 기반의 편집기를 사용하는 요즘 시대에 vi를 왜 배워야 할까? 여기에는 타당한 이유가 있다.

- vi는 어디에서나 사용이 가능하다. 원격 서버나 X의 환경설정이 망가진 로컬 시스템처럼 그래픽 환경이 지원되지 않은 시스템을 접하게 됐을 때, vi의 덕을 보게 된다. 물론 nano의 인기는 간술록 높아지고 있으나 광범위하게 사용되진 않는다. 유닉스 시스템상의 프로그램 호환성 표준인 POSIX는 vi를 필요로 한다.
- vi는 가볍고 빠르다. 많은 작업을 할 때, 시스템 메뉴에서 그래픽 텍스트 편집기를 불러와서 메가바이트의 용량에 달하는 프로그램이 실행될 때까지 기다리는 것보다는 vi 편집기를 불러오는 것이 훨씬 수월하다. 게다가 vi는 입력 속도를 중요시하여 설계되었기 때문에, 숙련된 vi 사용자는 편집하는 동안 절대 마우스를 사용하지 않는다.




---
# vi의 역사


vi의 첫 번째 버전은 1976년에 빌 조이(Bill joy)가 만들었다. 그는 미국의 UC 버클리 학생이었는데 나중에 선 마이크로시스템즈의 공동 창업자가 되었다. vi란 visual(보이는 것)이란 단어에서 따온 것인데, 그 이유는 원래 이 편집기는 커서로 비디오 터미널상에서 편집하는 것이 가능하도록 만들어진 것이기 때문이다. visual 편집기 이전에는 라인 편집기가 있었다. 이것은 한 번에 텍스트를 추가 또는 삭제하는 것과 같이, 적용할 변경 사에 대해 구체적으로 설명해야 한다. 비디오 터미널의 등장(텔레라이프 장치와 같은 출력 기반의 터미널이 아닌)으로 visual 편집기 사용이 가능해졌다. vi는 사실 ex라고 하는 강력한 라인 편집기를 포함하는데, 그래서 vi를 사용하면서 라인 편집 명령어도 사용할 수 있다.

대부분의 리눅스 배포판에는 진짜 vi가 없다. 대신 브람 무어나르(Bram Moolenaar)가 만든 vim(VilMproved)이라고 하는 vi 확장판이 있다. vim은 전통적인 유닉스의 vi 이상의 상당한 개인이 이뤄진 버전으로, 대개 리눅스 시스템에서는 vi라는 이름으로 심볼릭 링크되어(또는 별칭으로) 사용된다. 이제 우리가 논의하게 될 것은 사실은 vim이지만, vi라는 이름으로 불리는 시스템이다.


---
# vi 시작과 종료

vi를 시작하려면 다음과 같이 간단하게 입력하면 된다.

``` shell
┌──(kali㉿kali)-[~]
└─$ vi
         
```



nano 편집에서 했던 것처럼 제일 먼저 배워야 할 것은 종료하는 법이다. vi 편집기를 종료하려면 다음과 같이 입력하면 된다.
```
:q
```

그럼, 쉘 프롬프트가 다시 나타난다. 어떤 이유에서건 vi가 종료되지 않으면(보통 파일을 저장하지 않았을 경우가 원인) 느낌표를 추가해서 강제 종료할 수 있다.

```
:q!
```


**저자주**: vi 편집기를 쓰다가 '길을 잃었다면' Esc키를 두 번 입력하면 된다. 그럼 다시 방향이 잡힌다.


---
# 편집 모드

다시 vi 편집기를 실행한다. 이번에는 존재하지 않은 파일 이름을 입력해본다. 이것은 vi로 새 파일을 만드는 것이다.

``` shell
┌──(kali㉿kali)-[~]
└─$ rm -f foo.txt
                                                                                                                                                                                                                                           
┌──(kali㉿kali)-[~]
└─$ vi foo.txt

         
```

이 명령이 잘 실행되었다면 다음과 같은 화면이 나타나야 한다.

```
~
~
~
~
~
"foo.txt" [New]

```
앞에 나오는 ~ 기호들은 해당 중에 아무런 텍스트가 없다는 것을 나타낸다. 즉 파일이 비어있다는 뜻이다. 아직은 아무것도 입력하지 않는다.


vi 편집기에 대해 두 번째로 배워야 할 중요한 것은(첫 번째는 vi 종료하기 방법)은 바로 vi는 **모달 편집기**(modal editor)라는 사실이다. vi가 실행되면 **명령어 모드**로 시작된다. 이 모드에서는 대부분의 모든 키가 명령어를 의미하기 때문에, 만약 타이핑하면, vi는 기본적으로 미쳐 날뛰고 모든 것을 엉망으로 만들지도 모른다.


### 텍스트 입력 모드로 들어가기


파일에 텍스트를 입력하기 위해서는 반드시 **텍스트 입력 모드**로 들어가야 한다. 입력 모드로 들어가기 위해서는 I키를 입력하면 된다. 그 다음에 vim이 확장 모드에 실행되고 있다면 화면 하단에 다음과 같이 보여야 한다(vi 호환 모드에는 나타나지 않을 것이다).

```
--INSERT--
```

이제 텍스트를 입력하자.



```
The quick brown fox jumped over the lazy log.
```

텍스트 입력 모드를 종료하고 명령어 모드로 돌아가려면 ESC 키를 입력하면 된다.




### 저장하기



파일에 변경된 사항을 저장하기 위해선 반드시 **ex 명령어**를 명령어 모드에서 입력해야 한다.

: 키의 입력으로 간단하게 할 수 있다. 그런 다음 콜론 기호가 화면 아래로 나타나야 한다.
```
:
```


변경된 파일을 저장하려면, 콜론 다음에 w 문자를 입력하고 엔터키를 누른다.

```
:w
```

파일은 하드 드라이브에 저장되고 다음과 같은 확인 메시지가 화면 아래쪽에 나타날 것이다.

```
"foo.txt" 1L , 46B written (칼리 리눅스용)
"foo.txt" [New] 1L, 46C written (교재용)
```

**저자주**: VIM 문서를 본 적이 있다면, 혼란스럽게도 명령어 모드를 일반 모드라고 하고, ex 명령어를 명령어 모드라고 표현하고 있다는 것을 알 것이다. 이 점을 참고해야 한다.




- ***부연 설명***


호환성 모드

앞에서 시작 화면 예제를 통해 vi 호환 모드에서 실행되고 있는 텍스트를 보았다. 이는 vim이 확장 기능 대신 기본적인 기능에 가까운 모드에서 실행된다는 뜻이다. 이 장의 목적에 맞에 vim의 확장 기능까지 다루겠다. 그러기 위해서는 두 가지 옵션을 알아야 한다.

- vi 대신 vim을 실행한다.(실행이 되면 .bashrc 파일에 vi='vim'이라고 별칭을 추가하는 것도 좋다.)
- 다음 명령어로 vim 환경설정 파일에 한 줄 추가하라.

		echo "set nocp" >> ~/.vimrc

다른 리눅스 배포판에서는 다른 방식으로 vim을 패키징한다. 일부 배포판에서는 기본적으로 vim의 미니 버전이 설치되어 있어서 제한된 기능한 지원된다. 앞으로 예제를 실습하다 보면 몇 가지 기능이 없을지도 모르니, 그런 경우 vim 풀 버전을 설치해야 한다.



---

# 커서 이동

vi의 명령어 모드 상태에는 굉장히 많은 커서 이동 명령어가 있는데, 일부는 [[less]] 명령과 동일하다.

[표 12-1] 커서 이동 키

| 키                   | 커서 이동 방향                           |
| ------------------- | ---------------------------------- |
| L또는 오른쪽 방향키         | 오른쪽 한 문자                           |
| H 또는 왼쪽 방향키         | 왼쪽 한 문자                            |
| J또는 아래쪽 방향키         | 한 줄 아래로                            |
| K 또는 위쪽 방향키         | 한 줄 위로                             |
| 0(zero)             | 현재 줄 처음으로                          |
| shift-6(^)          | 현재 줄 첫 번째 공백이 아닌 글자로               |
| shift-4($)          | 현재 줄 마지막으로                         |
| W                   | 다음 단어나 구두점 기호 처음으로                 |
| shift-W(W)          | 다음 단어 처음으로, 구두점 기호 무시              |
| B                   | 이전 단어나 구두점 기호 처음으로                 |
| shift-B (B)         | 이전 단어 처음으로, 구두점 기호 무시              |
| ctrl-F 또는 page down | 한 페이지 아래로                          |
| ctrl-B 또는 page up   | 한 페이지 위로                           |
| number-shift-G      | 줄 번호로 이동 (1G를 입력하면 파일의 첫 번째 줄로 이동) |
| shift-G(G)          | 파일의 마지막 줄로                         |

왜 H,J,K,L 과 같은 문제가 커서 이동에 사용될까? 그 이유는 vi가 처음 만들어졌을 때, 모든 비디오 터미널이 화살표 키를 가지고 있지는 않았고 또한 숙련된 키보드 사용자들은 키보드에서 다른 곳으로 손가락을 들어올리지 않고 커서를 이동하기 위해서 일반 키보드를 사용했기 때문이다.

vi에 있는 많은 명령어 앞에서 숫자를 붙일 수 있다. 표 12-1에 있는 명령어 G의 쓰임과 같이 말이다. 명령어 앞에 숫자를 붙임으로서 명령어가 실행되어야 할 횟수를 지정할 수도 있다. 예를 들어 5j는 커서를 5줄 아래로 이동시켜 준다.


---
# 기본 편집

대부분의 편집은 텍스트를 입력하거나 삭제 또는 텍스트를 자르고 붙이기를 통해 이동하는 등의 몇 가지 기본적인 작업으로 이루어진다. 물론 vi는 vi만의 방법으로 이러한 모든 작업을 지원한다. 또한 제한적 형태로나마 실행취소 기능도 지원한다. U키를 명령어 모드에서 입력하게 될 경우, 마지막으로 했던 작업을 취소할 수 있다. 이는 기본적인 편집 명령어를 실행할 때 매우 편리한 기능이 될 것이다.


### 텍스트 덧붙이기


vi에는 몇 가지의 텍스트 입력 모드가 있다. 그 중에서도 이미 텍스트를 입력하기 위해 i 명령을 사용했다. 

잠시 우리가 만든 foo.txt 파일로 되돌아가 보자.
```
The quick brown fox jumped over the lazy dog.
```


만약 이 문장 맨 끝에 텍스트를 추가했다면, i 명령어는 이러한 작업을 수행하지 않음을 발견했을 것이다. 왜냐하면 줄의 맨 끝 쪽으로 커서를 이동시킬 수 없기 때문이다. ==vi는 텍스트를 덧붙이기 위한 명령어를 제공한다. 알아보기 쉽게 a라는 명령어를 사용한다.== 이 문장의 맨 끝으로 커서를 이동하고 a를 입력하면 커서는 그 줄 끝을 지나 추가된다. 그러면 vi는 텍스트 입력 모드로 들어가게 된다. 텍스트를 입력하겠다.

```
The quick fox jumped over the lazy dog. It was cool.
```

입력 모드를 종료하려면 ESC 키를 입력하라.


줄의 맨 끝에 텍스트를 덧붙이고 싶다면 vi가 제공하는 단축키를 활용해보자. 현재 줄의 맨 끝으로 이동해서 텍스트를 덧붙이기 할 수 있는 단축키가 바로 A 명령어다.

우선 0(zero) 명령어로 문장의 맨 앞으로 커서를 이동한 다음 A를 입력해서 다음과 같이 텍스트를 덧붙인다.

```
The quick fox jumped over the lazy dog. It was cool.

Line 2
Line 3
Line 4
Line 5
```

ESC 키로 입력 모드를 종료한다.

보는 바와 같이 A 명령어는 입력 모드가 실행되기 전에 이미 커서를 줄의 맨 끝으로 이동시켜 주기 때문에 매우 편리하다.


### 빈줄 추가


텍스트를 입력할 수 있는 방법으로 줄을 "띄우는"것이다. 즉 기존의 두 줄 사이를 띄어서 입력 모드로 들어가는 것이다. 두 명령어가 [표 12-2]에 나와있다.

[표 12-2] 빈 줄 추가 키

| 명령어 | 실행              |
| --- | --------------- |
| o   | 현재 줄 아래에 빈 줄 추가 |
| 0   | 현재 줄 위에 빈 줄 추가  |

다음과 같이 이것을 증명할 수 있다. 커서를 3번째 줄에 두고 o를 입력하라.

```
The quick fox jumped over the lazy dog. It was cool.

Line 2
Line 3

Line 4
Line 5
```

새로운 줄이 3번째 줄 아래에 생기고 입력 모드로 들어갔다. ESC 키로 입력 모드를 종료하자. u를 입력해서 방금한 작업을 취소도 해 보자.

0를 입력하면 현재 커서 위치 상단에 줄을 추가하게 될 것이다.

```
The quick fox jumped over the lazy dog. It was cool.

Line 2

Line 3
Line 4
Line 5
```

ESC 키로 입력 모드를 종료하고 u 명령어로 실행취소도 해 보자.


### 텍스트 삭제

예상한 대로 vi에는 텍스트를 삭제할 방법이 여럿 있다. 모두 키보드를 활용할 수 있다. 우선 X키는 현재 커서 위치에 있는 문자 한 개를 삭제한다. x 문자 앞에서 숫자가 나오면 그 숫자에 해당하는 개수만큼 문자가 삭제된다. D 키는 일반적인 삭제 용도로 쓰인다. x처럼 앞에 숫자가 나오는데 이는 몇 번의 삭제가 이루어질 것인지를 말해준다. 또한 d는 항상 삭제 크기를 결정하는 이동 명령어와 함께 쓰인다.

텍스트의 첫 번째 줄에 있는 It라는 단어 앞에 커서를 두고 그 문장의 나머지 문자가 다 삭제될 때까지 반복해서 x를 입력하라. 그런 다음 u를 방금 삭제한 작업이 모두 취소될 때까지 반복해서 입력하라.

- **저자주**: 실제 vi는 한 단계 수준의 실행취소만 지원한다. vim은 몇 단계까지도 가능하다.



[표 12-3] 텍스트 삭제 명령어

| 명령어  | 삭제 내용                            |
| ---- | -------------------------------- |
| x    | 현재 문자                            |
| 3x   | 현재 문자를 포함한 다음 2개 문자              |
| dd   | 현재 줄                             |
| 5dd  | 현재 줄을 포함한 다음 4줄                  |
| dw   | 현재 커서 위치부터 다음 단어 앞까지             |
| d$   | 현재 커서 위치부터 현재 줄 맨 앞까지            |
| d0   | 현재 커서 위치부터 현재 줄 맨 앞까지            |
| d^   | 현재 커서 위치부터 그 줄의 공백이 아닌 첫 번째 글짜까지 |
| dG   | 현재 줄부터 그 파일 끝까지                  |
| d20G | 현재 줄부터 파일의 20번째 줄까지              |
|      |                                  |

다시 삭제해보자. 이번에는 d 명령어를 사용해 볼 것이다. 다시 커서를 It 단어 앞에 두고 그 글자를 지우기 위해서 dw를 입력하라.

```
The quick brown fox jumped over the lazy log. was cool.
Line 2
Line 3
Line 4
Line 5dd
```

**d$** 를 입력하면 현재 커서 위치에서 그 줄 맨 끝까지 모두 삭제할 수 있다.
```
The quick fox jumped over the lazy dog.
Line 2
Line 3
Line 4
Line 5
```

**dG**를 입력하면 현재 줄에서부터 그 파일 끝까지 모두 삭제한다.

```
~
~
~
~
~
~

```
u 명령어를 세 번 입력하면 지금까지 해온 삭제 작업이 취소된다.



### 텍스트 자르기, 복사하기 그리고 붙이기

**d** 명령어가 단순히 텍스트를 삭제만 하는 것이 아니라 텍스트 '자르기'도 수행한다. d 명령어를 사용할 때마다, 삭제된 내용을 붙이기 버퍼(클립보드를 생각하자)에 복사되어 p 명령어로 그 내용을 다시 불러와서 커서 앞 또는 뒤로 붙이기를 수행한다.

y 명령어는 d 명령과 매우 비슷한 방법으로 텍스트를 자르고 "복사"하는 기능을 수행한다. [표 12-4]에서 y 명령어와 함께 사용하는 다양한 이동 명령어들을 소개한다.


[표 12-4] 복사 명령어

| 명령어  | 복사 내용                            |
| ---- | -------------------------------- |
| yy   | 현재 줄                             |
| 5yy  | 현재 줄을 포함한 다음 4줄                  |
| yw   | 현재 커서 위치부터 다음 단어 앞까지             |
| y$   | 현재 커서 위치부터 현재 줄 끝까지              |
| y0   | 현재 커서 위치부터 현재 줄 맨 앞까지            |
| y^   | 현재 커서 위치부터 그 줄의 공백이 아닌 첫 번재 글자까지 |
| yG   | 현재 줄부터 그 파일 끝까지                  |
| y20G | 현재 줄부터 파일의 20번째 줄까지              |


복사와 붙여넣기를 실행해보자. 커서를 텍스트의 첫 번째 줄에 두고 yy를 입력해서 현재 줄을 복사하자. 그 다음, 커서를 마지막 줄(G)로 이동해서 p를 입력하여 현재 줄 아래에 복사된 줄을 붙여보자.

```
The quick brown fox jumped over the lazy dog. It was cool
Line 2
Line 3
Line 4
Line 5
The quick brown fox jumped over the lazy dog. It was cool.
```

이전처럼, u 명령어로 실행을 취소할 수 있다. 커서가 여전히 파일의 맨 마지막 줄에 있다면 p를 입력하여 현재 줄 상단에 텍스트를 붙여보자.


```
The quick brown fox jumped over the lazy dog. It was cool.
Line 2
Line 3
Line 4
The quick brown fox jumped over the lazy dog. It was cool.
Line 5
```


[표 12-4]에 있는 다른 명령어를 실행해보고 p와 p 명령어가 어떤 결과를 보여주는지 이해하도록 하자. 했다면 파일을 원래 상태로 되돌려 놓자.


### 줄 합치기

vi 에서는 줄 개념이 상당히 까다롭다. 일반적으로, 줄 끝으로 커서를 이동하는 것이 불가능하고 이전 줄과 합치기 위해서 라인 끝(EOL, End of Line) 문자를 삭제하는 것이 불가능하다. 이러한 이유 때문에, vi는 특별한 명령어를 제공하는데, 바로 J(커서 이동에 사용하는 J와 혼동하지 말라. 반드시 대문자 J) 명령어로 줄을 연결하는데 사용한다.

```
The quick brown fox jumped over the lazy dog. It was cool.
Line 2
Line 3 Line 4
Line 5
```


---
# 검색 및 치환

vi는 검색된 위치로 커서를 이동하는 기능이 있다. 라인 내뿐만 아니라 파일 전체를 통틀어서 이동이 가능하다. 또한 사용자에게 확인 메시지를 주거나 혹은 없이 텍스트 치환이 가능하다.

### 줄에서 텍스트 검색

**f** 명령어는 줄을 검색해서 찾으려는 문자 위치로 커서를 이동시킨다. 예를 들어 fa 명령어는 현재 줄에 있는 a 문자를 찾아 이동시킨다. 검색을 수행하고 나서 세미콜론을 입력하면 반복 검색이 가능하다.


### 파일에서 텍스트 검색

단어나 문장에서 검색된 위치로 커서를 이동하기 위해서 / 명령어가 된다. 3장에서 배운 less 명령어와 동일한 방식으로 작동한다. **==/ 명령어를 입력하면, 슬래시가 화면 아래쪽에 나타난다. 그 다음, 검색하려는 단어나 문장을 입력하고 엔터키를 누른다. n 명령어를 사용하면 이전 검색어로 반복해준다.==** 예제를 살펴보자.


```
The quick brown fox jumped over the lazy dog. It was cool.
Line 2
Line 3
Line 4
Line 5
```

커서를 파일의 첫 번째 줄에 두고 다음과 같이 입력한 뒤 엔터키를 누르자.

```
/Line
```

커서는 2번째 줄로 이동될 것이고, n을 입력하면 커서는 3번째 줄로 이동될 것이다. n 명령어를 반복하여, 커서를 검색된 내용이 더 이상 나오지 않을 때까지 이동해보자. 지금까지 단어나 문장만을 검색 패턴으로 사용했는데, 복잡한 텍스트 패턴을 표현해주는 강력한 방법인 **정규 표현식**으로도 검색이 가능하다. 이는 19장에서 나온다.


### 전체 검색 및 치환

vi는 ex 명령어를 사용하여 해당 줄이나 파일 전체에서 검색할 내용을 찾아서 바꾸기 작업(vi에서는 치환으로 불림)을 수행한다. 파일 전체에서 Line을 line으로 바꾸기 위해 다음과 같은 명령어를 입력해야 한다.

```
:%s/Line/line/g
```

이 명령을 하나 살펴보겠다. (표 12-5 참조).


[표 12-5] 전체 검색 및 바꾸기 사용 예제

| 항목          | 뜻                                                                                                                                                                                       |
| ----------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| :           | 콜론 문자는 ex 명령어를 실행한다.                                                                                                                                                                    |
| %           | 작업을 수행해 줄 범위를 보여주고 있다. % 기호의 의미는 첫 번째 줄부터 마지막 줄까지라는 것을 담고 있다. 그렇지 않으면 1, 5와 같이 범위를 지정할 수 있다(여기에서는 현재 5줄까지만 있다). 또는 1, $를 입력하면 "1번 줄부터 끝까지"라는 의미로 해석된다. 줄 범위를 지정하지 않으면 현재 라인에만 작업이 수행된다. |
| s           | 작업을 지정한다. 이 경우에는 치환작업이다(검색하여 바꾸기).                                                                                                                                                      |
| /Line/line/ | 검색 패턴과 바꾸고자 하는 텍스트를 입력한다.                                                                                                                                                               |
| g           | 전체를 의미한다. 치환 작업은 매 줄마다 검색 문자열 하나씩 실행되는데, g를 사용하지 않으면 각 줄마다 첫 번째 검색 문자열만 변경된다.                                                                                                           |

검색하여 바꾸기 명령어를 실행하고 나면 파일은 다음과 같이 변경됐을 것이다.

```
The quick brown fox jumped over the lazy dog. It was cool.
line 2
line 3
line 4
line 5
```


사용자 확인 메시지를 표시하는 **치환 명령어**를 사용할 수 있다. 명령어 끝에 c를 입력하기만 하면 된다.
```
:%s/line/Line/gc
```

이 명령은 이 파일을 이전 형식으로 바꿔줄 것이다. 하지만 각각의 치환이 실행되기 전에, vi는 확인 메시지를 다음과 같이 보여준다.


```
replace with Line(y/n/a/q/l/^E/^Y)?
```

괄호 안의 문자들과 그에 상응하는 결과를 [표 12-6]에서 살펴보겠다.

[표 12-6] 치환 명령 확인 메시지 키

| 키              | 실행                                 |
| -------------- | ---------------------------------- |
| y              | 치환 실행.                             |
| n              | 이번 치환 건너뛰기.                        |
| a              | 전체 치환 실행                           |
| q or ESC       | 치환 중단.                             |
| l              | 이번 치환 후 종료(*last*).                |
| ctrl-E, ctrl-Y | 스크롤 위 아래로 이동하기. 치환 내용을 확인할 때 유용하다. |



---
# 다중 파일 편집

이번에는 한 번에 하나 이상의 파일을 수정할 때 유용한 방법을 소개한다. 여러 파일을 수정해야 할 경우나 한 파일에서 다른 파일로 내용을 복사해야 할 경우가 있을 수 있다. 커맨드라인에 다음과 같이 여러 파일을 지정하여 연 다음 vi로 편집할 수 있다.


vi *file1 file2 file3...*

일단 이전 vi 세션을 종료하고 새 파일을 편집하자. :wq를 입력해서 vi를 종료하고, 수정된 사항을 저장하자. 그 다음, 우리가 작업할 홈 디렉토리에 다른 파일을 만들자. ls 출력 결과를 가져와서 파일을 만들 것이다.


### 파일 간 전환

현재 파일을 다음 파일로 전환하려면, ex 명령어를 사용한다.

```
:n
```

이전 파일로 되돌아가려면 다음과 같이 입력한다.
```
:N
```

vi는 다른 파일로 전환할 때, 현재 파일이 저장되지 않았으면 파일을 전환할 수 없도록 하고 있다. 강제로 파일을 전환하고 변경사항을 저장하지 않으면 명령어에 느낌표(!)붙이면 된다.

앞서 설명했듯이 vim(또는 vi의 일부 버전만)은 여러 파일을 관리하기 쉽도록 ex 명령어 일부를 지원한다. **:buffers** 명령어로 수정 중인 파일 목록을 볼 수 있다. 이렇게 하면 화면 아래에 파일 목록이 표시된다.

``` shell
:buffers                                                                                
  1 %a=  "foo.txt"                      line 6
  2 #    "ls-output.txt"                line 243
Press ENTER or type command to continue

```


다른 버퍼(파일)로 전환하려면 :buffer 명령어 다음에 수정하려면 버퍼 번호를 입력하면 된다. 예를 들어, foo.txt 파일이 있는버퍼 1에서 ls-output.txt가 있는 버퍼 2로 전환하고 싶으면 다음과 같이 입력하면 된다.

```
:buffer 2
```

그럼 화면에는 두 번째 파일이 표시될 것이다.


### 다른 파일 열어서 편집

현재 편집 세션에 파일을 추가할 수 있다. ex 명령어인 **:e** (edit 준말) 다음에 파일명을 입력하면 다른 파일을 열 수 있다. 일단 현재 편집 세션을 종료하고 커맨드라인으로 돌아가자.


그리고 하나의 파일로 vi 편집기를 다시 시작하자.

``` shell
┌──(kali㉿kali)-[~]
└─$ vi foo.txt

```

두 번째 파일을 열기 위해서 다음과 같이 입력한다.

``` shell
:e ls-output.txt
```


그럼 화면에 이 파일이 나타난다. 첫 번째 파일이 여전히 열려있음을 확인할 수 있다.

``` shell
:buffers                                                                               
  1 #    "foo.txt"                      line 6
  2 %a   "ls-output.txt"                line 242
Press ENTER or type command to continue

```
**저자주**: :n이나 :N이 아닌 :e 명령어로 로드된 파일들은 전환이 불가능하다. 파일을 전환하려면 :buffer 명령어 다음에 버퍼 번호를 입력하라.


### 파일 내용을 다른 파일로 복사

여러 파일을 편집할 때, 파일의 일부를 현재 편집하고 있는 다른 파일로 복사하고 싶을 때가 종종 있을 것이다. 이 작업은 이미 알고 있는 복사와 붙여넣기 명령어로 쉽게 할 수 있다. 이를 이름과 같이 보여주려고 한다. 우선 두 파일을 가지고 다음과 같이 입력하여 버퍼 1(foo.txt)로 바꿀 것이다.


```
:buffer 1
```

다음과 같이 내용이 나타난다.


``` shell
The quick brown fox jumped over the lazy dog. It was cool.
line 2
line 3
line 4
line 5
```


그 다음, 커서를 첫째 줄로 이동하여 yy를 입력해서 그 줄을 복사하자.


다음과 같이 입력하면 두 번째 버퍼로 바뀌게 된다.

```
:buffer 2
```

화면에는 다음과 같이 몇 개의 파일이 보일 것이다.


커서를 첫째 줄로 이동하여 p 명령어로 이전 파일에 복사한 줄을 붙여 넣자.


```
total 753024
The quick brown fox jumped over the lazy dog. It was cool.
```


### 파일 전체를 다른 파일에 삽입

현재 편집중인 파일에 다른 파일 내용 전체를 삽입하는 것도 가능하다. 실행과정을 보기 위해서, 현재 vi 세션을 종료하고 하나의 파일로 다시 vi 편집기를 실행하자.

``` shell
                                                                                                                   
┌──(kali㉿kali)-[~]
└─$ vi ls-output.txt
                     
```
입력하면 여러 내용들이 나온다.


커서를 세 번째 줄로 이동하여 다음과 같은 ex 명령어를 입력한다.

```
:r foo.txt
```


:r 명령어(read의 준말)는 지정한 파일을 커서 위치 바로 앞에 삽입한다.


그렇게 되면 foo.txt 내용이 붙여넣기가 된다.


---
# 저장하기

vi의 다른 기능들처럼 편집한 파일을 저장하는 데에도 여러가지 방법이 있다. 이미 ex 명령어인 :w를 알고 있지만 도움이 도리 만한 다른 명령어들도 있다.

명령어 모드에서는 ZZ를 입력하여 현재 파일을 저장하고 vi를 종료할 수 있다. 유사하게, ex 명령어인 :wq는 :w와 :q 명령어가 결합한 형태로 파일을 저장하고 종료하는 작업을 수행한다.

:w명령어는 파일명을 지정할 수도 있다. 이는 다른 이름으로 저장하기와 비슷한 것이다. 예를 들어, foo.txt 파일을 편집하고 foo1.txt라는 다른 이름으로 저장하고 싶다면, 다음과 같이 입력하면 된다.

```
:w foo1.txt
```


저자주:  파일을 새 이름으로 저장되지만 편집 중인 현재 파일명은 존재하지 않는다. 따라서 편집을 계속하면, foo.txt 파일을 수정하는 것이지 foo1.txt 파일을 수정하는 것은 아니다.