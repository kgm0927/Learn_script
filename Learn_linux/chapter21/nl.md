
### 줄 번호 매기기

nl 프로그램은 단순히 줄 번호를 매기는 간단한 작업을 하는 꽤 신기한 툴이다. cat -n처럼 아주 간단히 사용한다.

``` shell

┌──(kali㉿kali)-[~]
└─$ nl distros.txt | head
     1  SUSE    10.2    12/07/2006
     2  Fedora  10      11/25/2008
     3  SUSE    11.0    06/19/2008
     4  Ubuntu  8.04    04/24/2008
     5  Fedora  8       11/08/2007
     6  SUSE    10.3    10/04/2007
     7  Ubuntu  6.10    10/26/2006
     8  Fedora  7       05/31/2007
     9  Ubuntu  7.10    10/18/2007
    10  Ubuntu  7.04    04/19/2007
                                        

```

nl도 cat처럼 커맨드라인 인자나 표준 입력으로 복수의 파일명도 허용한다. 그러나 nl은 많은 옵션이 있다. 좀 더 복잡한 방식의 번호를 붙이기 위해 마크업의 기본 형태를 지원한다.

nl은 번호를 붙일 때 **논리적 페이지**(logical pages)라는 개념을 제공한다. 이는 nl이 번호를 붙일 때 순서를 다시 처음부터 시작할 수 있도록 허용한다. 또한 옵션을 사용하면 특정 값 또는 제한된 범위 내에서 시작 번호를 설정 가능하고 그 포맷도 설정할 수 있다. 논리적 페이지는 추가적으로 머리말, 본문, 꼬리말로 세분화된다. 각 영역마다 줄 번호를 재설정하거나 다른 형태로 설정할 수 있다. 만약 nl에 복수의 파일이 주어지면, 단일한 텍스트 스트림으로 처리될 것이다. 텍스트 스트림의 각 영역은 [표 21-1]에 보이는 약간 이상하게 생긴 마크업을 추가하여 나타낼 수 있다.


- [표 21-1] nl 마크업

| 테스트      | 설명              |
| -------- | --------------- |
| `\:\:\:` | 논리적 페이지의 머리말 시작 |
| `\:\:`   | 논리적 페이지의 본문 시작  |
| `\:`     | 논리적 페이지의 꼬리말 시작 |

[표 21-1]의 각 마크업 요소는 해당 줄에 단독으로 나타내야 한다. 마크업 요소가 처리되고 나면, nl은 텍스트 스트림에서 그것들을 제거한다. [표 21-2]는 nl의 주요 옵션을 나타낸 것이다.


- [표 21-2] nl 주요 옵션


| 옵션          | 의미                                                 |
| ----------- | -------------------------------------------------- |
| -b *style*  | 본문의 줄 번호에 스타일을 적용한다. *style*은 다음 중 하나를 사용할 수 있다.   |
| ^           | ^ **a** 모든 줄에 번호를 붙인다.                             |
| ^           | ^ **t** 공백 줄이 아닌 경우에만 번호를 붙인다. 기본값이다.              |
| ^           | ^ **n** 번호를 붙이지 않는다.                               |
| ^           | ^ ***pregexp*** 기본 정규표현식과 일치하는 줄에만 번호를 붙인다.        |
| -f *style*  | 꼬리말의 줄 번호에 스타일을 적용한다. 기본값은 n.                      |
| -h *style*  | 머리말의 줄 번호에 스타일을 적용한다. 기본값은 n.                      |
| -i *number* | 페이지 번호의 증가량을 *number*로 설정한다. 기본값은 1.               |
| -n *format* | 줄 번호 포맷을 설정한다. *format*은 다음 중 하나를 사용할 수 있다.        |
| ^           | ^ **ln** 0 없이, 왼쪽 정렬.                              |
| ^           | ^ **rn** 0 없이, 오른쪽 정렬. 기본값이다.                      |
| ^           | ^ **rz** 0 포함. 오른쪽 정렬                              |
| -p          | 각 논리 페이지의 시작 부분에서 페이지 번호를 재설정하지 못하게 막는다.           |
| -s *string* | *string*을 구분자로 만들기 위해 각 줄의 번호의 끝에 추가한다. 기본값은 탭 문자. |
| -v *number* | 각 논리 페이지의 첫째  줄 번호를 number로 설정한다. 기본값은 1.          |
| -w *width*  | *width*를 줄 번호 필드의 너비로 설정한다. 기본값은 6.                |

인정하건대, 아마 줄 번호를 매기는 경우가 자주 있지는 않을 것이다. ==하지만 좀 더 복잡한 작업을 하기 위해 여러 툴들을 어떻게 결합할 수 있는지 살펴보기 위해 nl를 사용할 수 있다.== 우리는 리눅스 배포판 보고서를 만들기 위해서 이전 장에서 했던 작업을 빌드할 것이고, nl을 사용하기 때문에 머리말/본문/꼬리말 마크업이 유용하게 될 것이다. 이를 위해, 지난 장에서 본 sed 스크립트에 마크업을 추가할 것이다. 테스트 편집기를 사용하여 다음과 같이 스크립트를 변경하고 distros-nl.sed이라는 파일로 저장할 것이다.
sed
``` shell
#sed script to produce Linux distributions report


1 i\
\\:\\:\\:\
\
Linux Distributions Report\
\
Name            Ver.    Released\
----            ----    --------\
\\:\\:
s/\([0-9]\{2\}\)\/\([0-9]\{2\}\)\/\([0-9]\{4\}\)$/\3-\1-\2/
$ a\
\\:\
\
End of Report

```

스트립트에 nl 논리 페이지 마크업을 삽입하고 보고서의 끝 부분에 꼬리말을 추가한다. ==**마크업 두 쌍의 백슬래시가 필요하다는 것을 명심해라.**== 왜냐하면 sed는 일반적으로 그것을 이스케이프 문자로 해석하기 때문이다.

다음은 sort, sed, nl을 결합하여 개선된 보고서를 만든 것이다.

``` shell
┌──(kali㉿kali)-[~]
└─$ sort -k 1,1 -k 2n distros.txt | sed -f distros-nl.sed | nl

       
       Linux Distributions Report
       
       Name             Ver.    Released
       ----             ----    --------

     1  Fedora  5       2006-03-20
     2  Fedora  6       2006-10-24
     3  Fedora  7       2007-05-31
     4  Fedora  8       2007-11-08
     5  Fedora  9       2008-05-13
     6  Fedora  10      2008-11-25
     7  SUSE    10.1    2007-05-11
     8  SUSE    10.2    2006-12-07
     9  SUSE    10.3    2007-10-04
    10  SUSE    11.0    2008-06-19
    11  Ubuntu  6.06    2006-06-01
    12  Ubuntu  6.10    2006-10-26
    13  Ubuntu  7.04    2007-04-19
    14  Ubuntu  7.10    2007-10-18
    15  Ubuntu  8.04    2008-04-24
    16  Ubuntu  8.10    2008-10-30


```

이 보고서는 명령어 파이프라인의 결과로 만들어졌다. 먼저, 배포판의 이름과 버전(필드 1과 2)에 의해 정렬된다. 그러고 나서 그 결과를 sed로 처리하고, 보고서 머리말(nl용 논리 페이지 마크업을 포함한)과 꼬리말을 추가한다. 마지막으로 nl로 이 결과를 처리하면, 기본적으로 논리 페이지의 본문 영역에 포함된 텍스트 스트림에 줄 번호가 매겨진다.


nl에 다른 옵션을 주고 다시 한번 실험해볼 수 있다. 흥미로운 옵션 중에는

`nl -n rz`

와

`nl -w 3 -s ' '`

가 있다.


