

**VPN**(virtual private network, 가상사설망)은 인터넷과 같이 여러 사람이 공용으로 사용하는 공중망(public network)을 특정인이나 조직이 단독으로 사용하는 사설망(private network)처럼 동작시키는 것을 말한다.

VPN을 이용하면 본지시간의 네트워크를 전용선으로 구축하는 것에 비하여 훨씬 적은 비용으로 유지할 수 있다. 또, 인터넷 전화 등 업무의 네트워크 의존도가 거의 절대적인 요즈음의 상황에서 전용선의 장애에 대비하여 VPN을 이용한 네트워크의 이중화를 구현한다. 뿐만 아니라, 전용선을 이용한 사설 네트워크 환경에서도 데이터의 보안을 위하여 VPN의 사용은 필수적이다.


### VPN의 기능

VPN을 사용하여 공중망을 사설망처럼 안전하게 이용하려면 다음과 같은 기능이 지원되어야 한다. 

-  **통신 상대방 확인**

처음 통신을 시작할 때 상대방이 엉뚱한 사람이 아니라는 것을 확인해야 한다.<mark style="background: #ADCCFFA6;"> 이처럼 통신 상대방을 확인하는 것</mark>을 **인증**(authentication)이라고 한다. 인증방식은 미리 양측에 동일한 암호를 지정하는 **PSK**(preshared key) 방식과 디지털 인증서를 사용하는 방식이 있다.

-  **데이터의 기밀성 유지**

<mark style="background: #ADCCFFA6;">송수신하는 데이터의 내용을 다른 사람이 알지 못하게 암호화시키는 것</mark>을 **기밀**(confidentiality) **유지 기능**이라고 한다. VPN에서 많이 사용하는 암호화 방식으로 DES, 3DES, AES, RC4 등이 있다.


-  **데이터의 무결성 확인**

송수신하는 데이터를 도중의 공격자가 변조하는 것을 방지하는 기능을 **무결성**(integrity) 확인이라고 한다. 많이 사용하는 <mark style="background: #ADCCFFA6;">무결성 확인 방식으로 MD5와 SHA-1이 있다.</mark> 패킷과 암호를 이용하여 **MD5**나 **SHA-1** 알고리즘을 적용하여 만든 코드를 **해시코드**(hash code)라고 한다. 이 해시코드를 패킷에 첨부하여 상대에게 전송한다.

패킷을 수신한 측에서는 동일한 패킷에 동일한 암호를 적용하여 해시코드를 계산한다. 이것이 첨부된 해시코드와 동일하면 변조가 되지 않았다고 판단한다. 해시코드는 변조방지 용도외에 인증용으로도 사용된다.


-  **재생방지**

**재생방지**(anti-replay)란<mark style="background: #ADCCFFA6;"> 공격자가 자신의 패킷을 도중에 끼워넣는 것을 방지하는 기능을 말한다.</mark> 패킷의 순서번호나 도착시간을 확인하여 사전에 지정된 범위의 것들만 받아들임으로써 재생방지의 목적을 달성할 수 있다.

### VPN의 종류

현재 사용되는 주요 VPN의 종류를 표로 나타내면 다음과 같다.

[표 1-1] *VPN의 종류*


| VPN 종류    | <             | 암호화 부분    | 주요 용도       | 비고                     |
| --------- | ------------- | --------- | ----------- | ---------------------- |
| IPsec VPN | 순수 IPsec VPN  | 레이어 3 이상  | 본사지간의 통신    | 기본적인 IPsec             |
| ^         | GRE IPsec VPN | 레이어 3 이상  | 본사지간의 통신    | GRE를 이용한 라우팅 해결        |
| ^         | DMVPN         | 레이어 3 이상  | 본사지간의 통신    | 대규모 VPN                |
| ^         | IPsec VTI     | 레이어 3 이상  | 본사지간의 통신    | VPN 설정 간편              |
| ^         | Easy VPN      | 레이어 3 이상  | PC와 본사간의 통신 | 외부근무 사원의 내부망 접속 허용     |
| ^         | GET VPN       | 레이어 4 이상  | 본사지간의 통신    | 대규모 VPN, 멀티캐스트, QoS 지원 |
| SSL VPN   | <             | 레이어 5 이상  | PC와 서버간의 통신 | 전자상거래 용도               |
| PPTP VPN  | <             | 레이어 2 이상  | PC와 본사간의 통신 | 외부근무 사원의 내부망 접속 허용     |
| L2TP VPN  | <             | 레이어 2 이상  | PC와 본사간의 통신 | 외부근무 사원의 내부망 접속 허용     |
| MPLS VPN  | <             | 암호화 기능 없음 | 본사지간의 통신    | IPsec VPN과 동시 사용       |

본서에서는 위의 표에 있는 VPN 중에서 가장 아래의 MPLS VPN을 제외한 나머지 모든 VPN에 대해서 동작방식과 설정방법을 설명하고, 실제 동작하는 것을 확인한다. MPLS VPN은 필자의 저서 '최신 MPLS'에 자세히 설명되어 있다.


### 암호의 구분 및 용도

VPN에서는 인증, 데이터 암호화 및 변조 방지를 위하여 암호(키)가 필요하다.

암호는 양측에서 사용된 것이 동일한지의 여부에 따라 대칭키와 비대칭키로 구분된다. 대칭키는 양측에서 사용하는 암호가 동일한 것을 말한다. 대표적인 대칭키로 **양측에 미리 설정된 암호** (PSK, pre-shared key)나 **디피-헬먼**(Diffie-Hellman) 알고리즘에 의해서 생성된 키를 들 수 있다.

**비대칭키**는 <mark style="background: #ADCCFFA6;">한쪽에서 사용한 암호와 상대가 사용하는 암호가 서로 다른 것을 말한다.</mark> 즉, 비대칭키는 암호화 및 복호화에 사용되는 키가 서로 다르며, 대표적인 것으로 개발자의 이름을 딴 RSA(Rivest, Shamir, Adelman) 키가 있다.

비대칭키는 공개키(public key)와 개인키(private key)의 쌍으로 이루어진다. 송신자가 상대방의 공개키로 패킷을 암호화해서 보내면 수신자는 자신의 개인키로 복호화한다. 공개키는 다른 사람에게 공개되면 개인키는 각자가 보관한다. 특정인의 공개키로 암호화된 것은 그 공개키와 쌍을 이루는 개인키로만 복호화시킬 수 있다.

<mark style="background: #ADCCFFA6;">인터넷 뱅킹, 전자상거래 등에서 사용할 공인 인증서의 소유자를 인증해주는 조직 즉 인증기관</mark>을 **CA**(certificate authority)라고 한다. 우리나라에는 한국정보인증(주), 금융결제원, 한국정보사회진흥원, 한국전자인증(주), (주)한국무역정보통신 여섯 곳이 CA 서비스를 제공하고 있다. 또, 조직 내부에서 VPN 등의 용도로 사용하기 위하여 라우터나 서버를 CA로 동작시켜 사용할 수 있다.

일반적으로 보안 <mark style="background: #ADCCFFA6;">통신을 하는 두 개의 장비들은 인증, 데이터 암호화 및 변조 방지를 위하여 별개의 방식으로 생성된 암호를 사용한다.</mark> 예를 들어, 인증을 위하여는 대칭키인 **PSK**(pre-shared key)나 비대칭키인 디지털인증서 (공인인증서)를 사용한다.

그러나, 인증시 사용하는 암호방식의 대칭키 또는 비대칭키 여부와 상관없이 이후 데이터 송수신시에는 암호화 및 변조방지를 위하여 일시적으로 생성한 대칭키를 사용한다. 

기본적으로 <mark style="background: #ADCCFFA6;">세션이 종료되면 대칭키를 제거하고, 새로운 세션에는 새로운 대칭키를 생성하여 사용한다.</mark> IPsec VPN은 디피-헬먼 알고리즘을 이용하여 암호화 및 해싱을 위한 임시 대칭키를 만들어 사용한다.

**SSL VPN**은 <mark style="background: #ADCCFFA6;">초기 핸드셰이킹(handshaking) 과정에서 클라이언트가 서버의 공개키를 이용하여 임의의 수를 암호화시킨 후 결과를 서버에게 전송하고, 서버는 자신의 개인키를 이용하여 이를 복호화시킨다.</mark> 이때 사용한 임의의 수를 이용하여 양측은 패킷의 암호화 및 복호화에 필요한 임시 암호(키)를 생성하여 사용한다.